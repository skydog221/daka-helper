<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç»Ÿä¸€UIæµ‹è¯• - æ‰“å¡åŠ©æ‰‹</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
    .container { max-width: 1200px; margin: 0 auto; }
    .test-section { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    h1 { color: #667eea; }
    h2 { color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
    .test-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
    .status { padding: 4px 12px; border-radius: 12px; font-weight: 600; font-size: 0.9em; }
    .pending { background: #ffc107; color: #333; }
    .pass { background: #28a745; color: white; }
    .fail { background: #dc3545; color: white; }
    button { background: #667eea; color: white; border: none; padding: 12px 30px; border-radius: 25px; cursor: pointer; font-size: 1.1em; margin: 20px 0; }
    button:hover { background: #5568d3; }
    #log { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.9em; max-height: 300px; overflow-y: auto; margin-top: 20px; }
    .log-success { color: #81c784; }
    .log-error { color: #e57373; }
    iframe { width: 100%; height: 800px; border: none; border-radius: 8px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="test-section">
      <h1>ğŸ§ª ç»Ÿä¸€UIæµ‹è¯•å¥—ä»¶</h1>
      <p>æµ‹è¯• src/ui/ ç»Ÿä¸€æ¶æ„åŠŸèƒ½</p>
      <button onclick="runTests()">ğŸš€ è¿è¡Œæµ‹è¯•</button>
    </div>

    <div class="test-section">
      <h2>ğŸ“¦ æ¨¡å—åŠ è½½æµ‹è¯•</h2>
      <div class="test-item"><span>æ ¸å¿ƒæ¨¡å—</span><span class="status pending" id="s1">å¾…æµ‹è¯•</span></div>
      <div class="test-item"><span>ç¼–ç å™¨</span><span class="status pending" id="s2">å¾…æµ‹è¯•</span></div>
      <div class="test-item"><span>é€‚é…å™¨</span><span class="status pending" id="s3">å¾…æµ‹è¯•</span></div>
      <div class="test-item"><span>lamejs</span><span class="status pending" id="s4">å¾…æµ‹è¯•</span></div>
    </div>

    <div class="test-section">
      <h2>âš™ï¸ æ ¸å¿ƒç®—æ³•æµ‹è¯•</h2>
      <div class="test-item"><span>æ—¶é—´è®¡ç®—</span><span class="status pending" id="s5">å¾…æµ‹è¯•</span></div>
      <div class="test-item"><span>éšæœºå»¶é•¿</span><span class="status pending" id="s6">å¾…æµ‹è¯•</span></div>
      <div class="test-item"><span>è¾“å…¥éªŒè¯</span><span class="status pending" id="s7">å¾…æµ‹è¯•</span></div>
      <div class="test-item"><span>æ ¼å¼æ£€æµ‹</span><span class="status pending" id="s8">å¾…æµ‹è¯•</span></div>
    </div>

    <div class="test-section">
      <h2>ğŸ“Š æµ‹è¯•æ—¥å¿—</h2>
      <div id="log"></div>
    </div>

    <div class="test-section">
      <h2>ğŸ“± åº”ç”¨é¢„è§ˆ</h2>
      <iframe src="src/ui/index.html"></iframe>
    </div>
  </div>

  <script type="module">
    function log(msg, type = 'info') {
      const el = document.getElementById('log');
      const color = type === 'success' ? 'log-success' : type === 'error' ? 'log-error' : '';
      el.innerHTML += `<div class="${color}">[${new Date().toLocaleTimeString()}] ${msg}</div>`;
      el.scrollTop = el.scrollHeight;
    }

    function setStatus(id, pass, msg) {
      const el = document.getElementById(id);
      el.className = `status ${pass ? 'pass' : 'fail'}`;
      el.textContent = pass ? 'âœ“ é€šè¿‡' : 'âœ— å¤±è´¥';
      log(`${pass ? 'âœ“' : 'âœ—'} ${msg}`, pass ? 'success' : 'error');
    }

    window.runTests = async function() {
      document.getElementById('log').innerHTML = '';
      log('å¼€å§‹æµ‹è¯•...', 'info');

      // 1. æ¨¡å—åŠ è½½æµ‹è¯•
      try {
        const { TimeCalculator } = await import('./src/core/time-calculator.js');
        const { Validator } = await import('./src/core/validator.js');
        setStatus('s1', TimeCalculator && Validator, 'æ ¸å¿ƒæ¨¡å—åŠ è½½');
      } catch(e) { setStatus('s1', false, `æ ¸å¿ƒæ¨¡å—: ${e.message}`); }

      try {
        const { WavEncoder } = await import('./src/encoders/wav-encoder.js');
        const { Mp3Encoder } = await import('./src/encoders/mp3-encoder.js');
        setStatus('s2', WavEncoder && Mp3Encoder, 'ç¼–ç å™¨åŠ è½½');
      } catch(e) { setStatus('s2', false, `ç¼–ç å™¨: ${e.message}`); }

      try {
        const { PlatformDetector } = await import('./src/adapters/platform-detector.js');
        const { getConfigStorage } = await import('./src/adapters/config-storage.js');
        setStatus('s3', PlatformDetector && getConfigStorage, 'é€‚é…å™¨åŠ è½½');
      } catch(e) { setStatus('s3', false, `é€‚é…å™¨: ${e.message}`); }

      setStatus('s4', typeof window.lamejs !== 'undefined', 'lamejsåŠ è½½');

      // 2. æ ¸å¿ƒç®—æ³•æµ‹è¯•
      try {
        const { TimeCalculator } = await import('./src/core/time-calculator.js');
        const d1 = TimeCalculator.minutesToSeconds(5, 30);
        const d2 = TimeCalculator.formatDuration(125);
        setStatus('s5', d1 === 330 && d2 === '2:05', `æ—¶é—´è®¡ç®—: 5:30=${d1}s, 125s=${d2}`);
      } catch(e) { setStatus('s5', false, `æ—¶é—´è®¡ç®—: ${e.message}`); }

      try {
        const { TimeCalculator } = await import('./src/core/time-calculator.js');
        const results = [];
        for(let i=0; i<10; i++) results.push(TimeCalculator.calculateExtendedDuration(100, 30));
        const ok = results.every(v => v >= 100 && v <= 130) && new Set(results).size > 1;
        setStatus('s6', ok, `éšæœºå»¶é•¿: èŒƒå›´[100-130], æ ·æœ¬=${results.slice(0,3).join(',')}`);
      } catch(e) { setStatus('s6', false, `éšæœºå»¶é•¿: ${e.message}`); }

      try {
        const { Validator } = await import('./src/core/validator.js');
        const v1 = Validator.validateTargetDuration(10, 30);
        const v2 = Validator.validateTargetDuration(-1, 30);
        setStatus('s7', v1.valid && !v2.valid, 'è¾“å…¥éªŒè¯');
      } catch(e) { setStatus('s7', false, `è¾“å…¥éªŒè¯: ${e.message}`); }

      try {
        const { FormatDetector } = await import('./src/core/format-detector.js');
        // åˆ›å»ºæ¨¡æ‹Ÿæ–‡ä»¶å¯¹è±¡
        const mockFile1 = { name: 'test.mp3', type: 'audio/mpeg' };
        const mockFile2 = { name: 'test.wav', type: 'audio/wav' };
        const f1 = FormatDetector.detectFromFile(mockFile1);
        const f2 = FormatDetector.detectFromFile(mockFile2);
        setStatus('s8', f1.format === 'mp3' && f2.format === 'wav', `æ ¼å¼æ£€æµ‹: ${f1.format}, ${f2.format}`);
      } catch(e) { setStatus('s8', false, `æ ¼å¼æ£€æµ‹: ${e.message}`); }

      log('æµ‹è¯•å®Œæˆï¼', 'info');
    };
  </script>
</body>
</html>