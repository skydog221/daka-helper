<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ ¸å¿ƒæ¨¡å—æµ‹è¯• - Daka Helper</title>
  
  <!-- åŠ è½½ lamejs åº“ï¼ˆMP3 ç¼–ç å™¨ä¾èµ–ï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/lamejs@1.2.1/lame.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      color: white;
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.5em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .test-section {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }
    
    .test-section h2 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.5em;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }
    
    .test-item {
      margin: 15px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    
    .test-item h3 {
      color: #333;
      margin-bottom: 10px;
      font-size: 1.1em;
    }
    
    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
      transition: all 0.3s;
    }
    
    button:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .result {
      margin-top: 10px;
      padding: 10px;
      background: white;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      word-break: break-all;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .success {
      color: #28a745;
      font-weight: bold;
    }
    
    .error {
      color: #dc3545;
      font-weight: bold;
    }
    
    .info {
      color: #17a2b8;
    }
    
    input[type="file"] {
      display: none;
    }
    
    .file-label {
      display: inline-block;
      background: #28a745;
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .file-label:hover {
      background: #218838;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    
    .stat-card .label {
      font-size: 12px;
      opacity: 0.9;
      margin-bottom: 5px;
    }
    
    .stat-card .value {
      font-size: 24px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª æ ¸å¿ƒæ¨¡å—æµ‹è¯•</h1>
    
    <!-- æ—¶é—´è®¡ç®—å·¥å…·æµ‹è¯• -->
    <div class="test-section">
      <h2>â±ï¸ TimeCalculator æµ‹è¯•</h2>
      
      <div class="test-item">
        <h3>æµ‹è¯•1: æ—¶é—´è½¬æ¢</h3>
        <button onclick="testTimeConversion()">è¿è¡Œæµ‹è¯•</button>
        <div id="time-conversion-result" class="result"></div>
      </div>
      
      <div class="test-item">
        <h3>æµ‹è¯•2: å»¶é•¿è®¡ç®—</h3>
        <button onclick="testExtendCalculation()">è¿è¡Œæµ‹è¯•</button>
        <div id="extend-calculation-result" class="result"></div>
      </div>
      
      <div class="test-item">
        <h3>æµ‹è¯•3: é‡å¤æ¬¡æ•°è®¡ç®—</h3>
        <button onclick="testRepeatCount()">è¿è¡Œæµ‹è¯•</button>
        <div id="repeat-count-result" class="result"></div>
      </div>
    </div>
    
    <!-- éªŒè¯å™¨æµ‹è¯• -->
    <div class="test-section">
      <h2>âœ… Validator æµ‹è¯•</h2>
      
      <div class="test-item">
        <h3>æµ‹è¯•4: æ—¶é•¿éªŒè¯</h3>
        <button onclick="testDurationValidation()">è¿è¡Œæµ‹è¯•</button>
        <div id="duration-validation-result" class="result"></div>
      </div>
      
      <div class="test-item">
        <h3>æµ‹è¯•5: å»¶é•¿éªŒè¯</h3>
        <button onclick="testExtendValidation()">è¿è¡Œæµ‹è¯•</button>
        <div id="extend-validation-result" class="result"></div>
      </div>
    </div>
    
    <!-- æ ¼å¼æ£€æµ‹å™¨æµ‹è¯• -->
    <div class="test-section">
      <h2>ğŸ” FormatDetector æµ‹è¯•</h2>
      
      <div class="test-item">
        <h3>æµ‹è¯•6: æ–‡ä»¶æ ¼å¼æ£€æµ‹</h3>
        <label class="file-label" for="test-file">é€‰æ‹©éŸ³é¢‘æ–‡ä»¶</label>
        <input type="file" id="test-file" accept="audio/*" onchange="testFormatDetection(this.files[0])">
        <div id="format-detection-result" class="result"></div>
      </div>
      
      <div class="test-item">
        <h3>æµ‹è¯•7: æ”¯æŒæ ¼å¼åˆ—è¡¨</h3>
        <button onclick="testSupportedFormats()">è¿è¡Œæµ‹è¯•</button>
        <div id="supported-formats-result" class="result"></div>
      </div>
    </div>
    
    <!-- éŸ³é¢‘ç¼–ç å™¨æµ‹è¯• -->
    <div class="test-section">
      <h2>ğŸµ AudioEncoder æµ‹è¯•</h2>
      
      <div class="test-item">
        <h3>æµ‹è¯•8: æ ¼å¼æ¨è</h3>
        <button onclick="testFormatRecommendation()">è¿è¡Œæµ‹è¯•</button>
        <div id="format-recommendation-result" class="result"></div>
      </div>
      
      <div class="test-item">
        <h3>æµ‹è¯•9: æ–‡ä»¶å¤§å°é¢„ä¼°</h3>
        <button onclick="testSizeEstimation()">è¿è¡Œæµ‹è¯•</button>
        <div id="size-estimation-result" class="result"></div>
      </div>
      
      <div class="test-item">
        <h3>æµ‹è¯•10: ç¼–ç æ—¶é—´é¢„ä¼°</h3>
        <button onclick="testTimeEstimation()">è¿è¡Œæµ‹è¯•</button>
        <div id="time-estimation-result" class="result"></div>
      </div>
    </div>
    
    <!-- å®Œæ•´æµç¨‹æµ‹è¯• -->
    <div class="test-section">
      <h2>ğŸ”„ å®Œæ•´æµç¨‹æµ‹è¯•</h2>
      
      <div class="test-item">
        <h3>æµ‹è¯•11: ç«¯åˆ°ç«¯éŸ³é¢‘å¤„ç†</h3>
        <label class="file-label" for="full-test-file">é€‰æ‹©éŸ³é¢‘æ–‡ä»¶</label>
        <input type="file" id="full-test-file" accept="audio/*" onchange="testFullPipeline(this.files[0])">
        <div id="full-pipeline-result" class="result"></div>
        <div id="full-pipeline-stats" class="stats" style="display:none;">
          <div class="stat-card">
            <div class="label">åŸå§‹æ—¶é•¿</div>
            <div class="value" id="stat-source-duration">-</div>
          </div>
          <div class="stat-card">
            <div class="label">ç›®æ ‡æ—¶é•¿</div>
            <div class="value" id="stat-target-duration">-</div>
          </div>
          <div class="stat-card">
            <div class="label">é‡å¤æ¬¡æ•°</div>
            <div class="value" id="stat-repeat-count">-</div>
          </div>
          <div class="stat-card">
            <div class="label">è¾“å‡ºæ ¼å¼</div>
            <div class="value" id="stat-output-format">-</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    // å¯¼å…¥æ ¸å¿ƒæ¨¡å—
    import { TimeCalculator } from './src/core/time-calculator.js';
    import { Validator } from './src/core/validator.js';
    import { FormatDetector } from './src/core/format-detector.js';
    import { AudioEncoder } from './src/encoders/audio-encoder.js';
    import { AudioRepeater } from './src/core/audio-repeater.js';
    
    // å°†æ¨¡å—æŒ‚è½½åˆ° window ä¾›æµ‹è¯•å‡½æ•°ä½¿ç”¨
    window.TimeCalculator = TimeCalculator;
    window.Validator = Validator;
    window.FormatDetector = FormatDetector;
    window.AudioEncoder = AudioEncoder;
    window.AudioRepeater = AudioRepeater;
    
    console.log('âœ… æ ¸å¿ƒæ¨¡å—åŠ è½½æˆåŠŸ');
  </script>

  <script>
    // æµ‹è¯•å‡½æ•°
    function testTimeConversion() {
      const result = document.getElementById('time-conversion-result');
      try {
        const tests = [
          { minutes: 5, seconds: 30, expected: 330 },
          { minutes: 0, seconds: 45, expected: 45 },
          { minutes: 2, seconds: 0, expected: 120 }
        ];
        
        let output = '<span class="success">âœ“ æ—¶é—´è½¬æ¢æµ‹è¯•é€šè¿‡</span>\n\n';
        
        tests.forEach((test, i) => {
          const seconds = TimeCalculator.minutesToSeconds(test.minutes, test.seconds);
          const back = TimeCalculator.secondsToMinutes(seconds);
          const formatted = TimeCalculator.formatDuration(seconds);
          
          output += `æµ‹è¯• ${i + 1}: ${test.minutes}åˆ†${test.seconds}ç§’\n`;
          output += `  â†’ ${seconds}ç§’ (é¢„æœŸ: ${test.expected}ç§’)\n`;
          output += `  â†’ è½¬å›: ${back.minutes}åˆ†${back.seconds}ç§’\n`;
          output += `  â†’ æ ¼å¼åŒ–: ${formatted}\n\n`;
        });
        
        result.innerHTML = output;
      } catch (error) {
        result.innerHTML = `<span class="error">âœ— é”™è¯¯: ${error.message}</span>`;
      }
    }
    
    function testExtendCalculation() {
      const result = document.getElementById('extend-calculation-result');
      try {
        const baseDuration = 300; // 5åˆ†é’Ÿ
        let output = '<span class="success">âœ“ å»¶é•¿è®¡ç®—æµ‹è¯•</span>\n\n';
        output += `åŸºç¡€æ—¶é•¿: ${baseDuration}ç§’ (${TimeCalculator.formatDuration(baseDuration)})\n\n`;
        
        const testSeconds = [0, 15, 30, 60, 120];
        testSeconds.forEach(seconds => {
          const extended = TimeCalculator.calculateExtendedDuration(baseDuration, seconds);
          output += `å»¶é•¿ ${seconds}ç§’: ${extended}ç§’ (${TimeCalculator.formatDuration(extended)})\n`;
        });
        
        result.innerHTML = output;
      } catch (error) {
        result.innerHTML = `<span class="error">âœ— é”™è¯¯: ${error.message}</span>`;
      }
    }
    
    function testRepeatCount() {
      const result = document.getElementById('repeat-count-result');
      try {
        const tests = [
          { source: 10, target: 35, expected: 4 },
          { source: 15, target: 60, expected: 4 },
          { source: 30, target: 100, expected: 4 }
        ];
        
        let output = '<span class="success">âœ“ é‡å¤æ¬¡æ•°è®¡ç®—æµ‹è¯•</span>\n\n';
        
        tests.forEach((test, i) => {
          const count = TimeCalculator.calculateRepeatCount(test.source, test.target);
          output += `æµ‹è¯• ${i + 1}: æº${test.source}ç§’ â†’ ç›®æ ‡${test.target}ç§’\n`;
          output += `  éœ€è¦é‡å¤: ${count}æ¬¡ (é¢„æœŸ: ${test.expected}æ¬¡)\n\n`;
        });
        
        result.innerHTML = output;
      } catch (error) {
        result.innerHTML = `<span class="error">âœ— é”™è¯¯: ${error.message}</span>`;
      }
    }
    
    function testDurationValidation() {
      const result = document.getElementById('duration-validation-result');
      try {
        const tests = [
          { minutes: 5, seconds: 30, valid: true },
          { minutes: 0, seconds: 0, valid: false },
          { minutes: 400, seconds: 0, valid: false },
          { minutes: -1, seconds: 30, valid: false }
        ];
        
        let output = '<span class="success">âœ“ æ—¶é•¿éªŒè¯æµ‹è¯•</span>\n\n';
        
        tests.forEach((test, i) => {
          const validation = Validator.validateTargetDuration(test.minutes, test.seconds);
          const match = validation.valid === test.valid;
          const icon = match ? 'âœ“' : 'âœ—';
          
          output += `${icon} æµ‹è¯• ${i + 1}: ${test.minutes}åˆ†${test.seconds}ç§’\n`;
          output += `  ç»“æœ: ${validation.valid ? 'æœ‰æ•ˆ' : 'æ— æ•ˆ'}\n`;
          if (!validation.valid) {
            output += `  åŸå› : ${validation.message}\n`;
          }
          output += '\n';
        });
        
        result.innerHTML = output;
      } catch (error) {
        result.innerHTML = `<span class="error">âœ— é”™è¯¯: ${error.message}</span>`;
      }
    }
    
    function testExtendValidation() {
      const result = document.getElementById('extend-validation-result');
      try {
        const tests = [
          { enabled: true, seconds: 30, valid: true },
          { enabled: false, seconds: 0, valid: true },
          { enabled: true, seconds: 400, valid: false },  // è¶…è¿‡æœ€å¤§å€¼300
          { enabled: true, seconds: -5, valid: false }
        ];
        
        let output = '<span class="success">âœ“ å»¶é•¿éªŒè¯æµ‹è¯•</span>\n\n';
        
        tests.forEach((test, i) => {
          const validation = Validator.validateExtend(test.enabled, test.seconds);
          const match = validation.valid === test.valid;
          const icon = match ? 'âœ“' : 'âœ—';
          
          output += `${icon} æµ‹è¯• ${i + 1}: ${test.enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}, ${test.seconds}ç§’\n`;
          output += `  ç»“æœ: ${validation.valid ? 'æœ‰æ•ˆ' : 'æ— æ•ˆ'}\n`;
          if (!validation.valid) {
            output += `  åŸå› : ${validation.message}\n`;
          }
          output += '\n';
        });
        
        result.innerHTML = output;
      } catch (error) {
        result.innerHTML = `<span class="error">âœ— é”™è¯¯: ${error.message}</span>`;
      }
    }
    
    function testFormatDetection(file) {
      const result = document.getElementById('format-detection-result');
      if (!file) {
        result.innerHTML = '<span class="info">è¯·é€‰æ‹©ä¸€ä¸ªéŸ³é¢‘æ–‡ä»¶</span>';
        return;
      }
      
      try {
        const detection = FormatDetector.detectFromFile(file);
        const validation = FormatDetector.validateAudioFile(file);
        
        let output = '<span class="success">âœ“ æ ¼å¼æ£€æµ‹å®Œæˆ</span>\n\n';
        output += `æ–‡ä»¶å: ${file.name}\n`;
        output += `æ–‡ä»¶å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)} MB\n`;
        output += `MIMEç±»å‹: ${file.type || 'æœªçŸ¥'}\n\n`;
        
        output += `æ£€æµ‹ç»“æœ:\n`;
        output += `  æ ¼å¼: ${detection.format ? detection.format.toUpperCase() : 'æœªçŸ¥'}\n`;
        output += `  ç½®ä¿¡åº¦: ${detection.confidence}%\n`;
        output += `  è¯¦æƒ…: ${detection.details}\n\n`;
        
        output += `éªŒè¯ç»“æœ:\n`;
        output += `  ${validation.valid ? 'âœ“ æœ‰æ•ˆ' : 'âœ— æ— æ•ˆ'}\n`;
        output += `  æ¶ˆæ¯: ${validation.message}\n`;
        
        result.innerHTML = output;
      } catch (error) {
        result.innerHTML = `<span class="error">âœ— é”™è¯¯: ${error.message}</span>`;
      }
    }
    
    function testSupportedFormats() {
      const result = document.getElementById('supported-formats-result');
      try {
        const formats = FormatDetector.getSupportedFormats();
        
        let output = '<span class="success">âœ“ æ”¯æŒçš„æ ¼å¼</span>\n\n';
        
        formats.forEach(format => {
          const info = FormatDetector.getFormatInfo(format);
          const browserSupport = FormatDetector.isBrowserSupported(format);
          
          output += `${format.toUpperCase()}: ${info.description}\n`;
          output += `  æ‰©å±•å: ${info.extensions.join(', ')}\n`;
          output += `  MIME: ${info.mimeTypes.join(', ')}\n`;
          output += `  æµè§ˆå™¨æ”¯æŒ: ${browserSupport ? 'âœ“ æ˜¯' : 'âœ— å¦'}\n\n`;
        });
        
        result.innerHTML = output;
      } catch (error) {
        result.innerHTML = `<span class="error">âœ— é”™è¯¯: ${error.message}</span>`;
      }
    }
    
    function testFormatRecommendation() {
      const result = document.getElementById('format-recommendation-result');
      try {
        const durations = [
          { value: 180, label: '3åˆ†é’Ÿ' },
          { value: 900, label: '15åˆ†é’Ÿ' },
          { value: 2400, label: '40åˆ†é’Ÿ' }
        ];
        
        let output = '<span class="success">âœ“ æ ¼å¼æ¨èæµ‹è¯•</span>\n\n';
        
        durations.forEach(({ value, label }) => {
          const rec = AudioEncoder.getFormatRecommendation(value);
          output += `${label} (${value}ç§’):\n`;
          output += `  æ¨èæ ¼å¼: ${rec.format.toUpperCase()}\n`;
          output += `  ç†ç”±: ${rec.reason}\n\n`;
        });
        
        result.innerHTML = output;
      } catch (error) {
        result.innerHTML = `<span class="error">âœ— é”™è¯¯: ${error.message}</span>`;
      }
    }
    
    function testSizeEstimation() {
      const result = document.getElementById('size-estimation-result');
      try {
        const duration = 300; // 5åˆ†é’Ÿ
        const formats = ['wav', 'mp3'];
        
        let output = '<span class="success">âœ“ æ–‡ä»¶å¤§å°é¢„ä¼°æµ‹è¯•</span>\n\n';
        output += `éŸ³é¢‘æ—¶é•¿: ${duration}ç§’ (5åˆ†é’Ÿ)\n\n`;
        
        formats.forEach(format => {
          const size = AudioEncoder.estimateFileSize(duration, format);
          output += `${format.toUpperCase()}:\n`;
          output += `  å¤§å°: ${size.formatted}\n`;
          output += `  å­—èŠ‚: ${size.bytes.toLocaleString()}\n`;
          output += `  MB: ${size.mb.toFixed(2)}\n\n`;
        });
        
        result.innerHTML = output;
      } catch (error) {
        result.innerHTML = `<span class="error">âœ— é”™è¯¯: ${error.message}</span>`;
      }
    }
    
    function testTimeEstimation() {
      const result = document.getElementById('time-estimation-result');
      try {
        const durations = [60, 300, 1800]; // 1åˆ†é’Ÿ, 5åˆ†é’Ÿ, 30åˆ†é’Ÿ
        const formats = ['wav', 'mp3'];
        
        let output = '<span class="success">âœ“ ç¼–ç æ—¶é—´é¢„ä¼°æµ‹è¯•</span>\n\n';
        
        durations.forEach(duration => {
          const minutes = Math.floor(duration / 60);
          output += `éŸ³é¢‘æ—¶é•¿: ${minutes}åˆ†é’Ÿ\n`;
          
          formats.forEach(format => {
            const time = AudioEncoder.estimateEncodeTime(duration, format);
            output += `  ${format.toUpperCase()}: ${time.formatted}\n`;
          });
          output += '\n';
        });
        
        result.innerHTML = output;
      } catch (error) {
        result.innerHTML = `<span class="error">âœ— é”™è¯¯: ${error.message}</span>`;
      }
    }
    
    async function testFullPipeline(file) {
      const result = document.getElementById('full-pipeline-result');
      const stats = document.getElementById('full-pipeline-stats');
      
      if (!file) {
        result.innerHTML = '<span class="info">è¯·é€‰æ‹©ä¸€ä¸ªéŸ³é¢‘æ–‡ä»¶</span>';
        return;
      }
      
      try {
        result.innerHTML = '<span class="info">â³ å¤„ç†ä¸­...</span>';
        stats.style.display = 'none';
        
        // 1. éªŒè¯æ–‡ä»¶
        const validation = FormatDetector.validateAudioFile(file);
        if (!validation.valid) {
          throw new Error(validation.message);
        }
        
        // 2. åˆ›å»º AudioContext
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // 3. è¯»å–æ–‡ä»¶
        const arrayBuffer = await file.arrayBuffer();
        
        // 4. è§£ç éŸ³é¢‘
        const sourceBuffer = await audioContext.decodeAudioData(arrayBuffer);
        
        // 5. è®¾ç½®ç›®æ ‡æ—¶é•¿ï¼ˆé‡å¤3æ¬¡ï¼‰
        const targetDuration = sourceBuffer.duration * 3;
        
        // 6. é‡å¤éŸ³é¢‘
        let output = '<span class="success">âœ“ å®Œæ•´æµç¨‹æµ‹è¯•æˆåŠŸ</span>\n\n';
        output += `æ­¥éª¤1: æ–‡ä»¶éªŒè¯ âœ“\n`;
        output += `  æ ¼å¼: ${validation.format.toUpperCase()}\n`;
        output += `  å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)} MB\n\n`;
        
        output += `æ­¥éª¤2: éŸ³é¢‘è§£ç  âœ“\n`;
        output += `  åŸå§‹æ—¶é•¿: ${sourceBuffer.duration.toFixed(2)}ç§’\n`;
        output += `  é‡‡æ ·ç‡: ${sourceBuffer.sampleRate} Hz\n`;
        output += `  å£°é“æ•°: ${sourceBuffer.numberOfChannels}\n\n`;
        
        output += `æ­¥éª¤3: éŸ³é¢‘é‡å¤å¤„ç†\n`;
        output += `  ç›®æ ‡æ—¶é•¿: ${targetDuration.toFixed(2)}ç§’\n`;
        
        const startTime = performance.now();
        const repeatedBuffer = await AudioRepeater.repeatAudio(
          sourceBuffer,
          targetDuration,
          audioContext,
          (progress) => {
            result.innerHTML = output + `  è¿›åº¦: ${progress}%\n`;
          }
        );
        const repeatTime = performance.now() - startTime;
        
        output += `  å®Œæˆæ—¶é—´: ${repeatTime.toFixed(0)}ms âœ“\n\n`;
        
        // 7. æ ¼å¼æ¨è
        const recommendation = AudioEncoder.getFormatRecommendation(targetDuration);
        output += `æ­¥éª¤4: æ ¼å¼æ¨è\n`;
        output += `  æ¨è: ${recommendation.format.toUpperCase()}\n`;
        output += `  ç†ç”±: ${recommendation.reason}\n\n`;
        
        // 8. æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
        const repeatCount = TimeCalculator.calculateRepeatCount(sourceBuffer.duration, targetDuration);
        
        document.getElementById('stat-source-duration').textContent =
          `${sourceBuffer.duration.toFixed(1)}ç§’`;
        document.getElementById('stat-target-duration').textContent =
          `${targetDuration.toFixed(1)}ç§’`;
        document.getElementById('stat-repeat-count').textContent =
          `${repeatCount}æ¬¡`;
        document.getElementById('stat-output-format').textContent =
          recommendation.format.toUpperCase();
        
        stats.style.display = 'grid';
        result.innerHTML = output;
        
      } catch (error) {
        result.innerHTML = `<span class="error">âœ— é”™è¯¯: ${error.message}</span>`;
        stats.style.display = 'none';
      }
    }
  </script>
</body>
</html>